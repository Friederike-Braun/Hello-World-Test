pipeline{
  agent any
  tools {
          maven "3.6.3"
          jdk "JDK-17"
  }

  stages{
    /*stage('Initialize'){
        steps {
            echo "PATH = ${M2_HOME}/bin:${PATH}"
            echo "M2_HOME = /opt/maven"
        }
    }*/
    stage('Clean'){
        steps {
            echo "Maven clean"
            //sh 'mvn clean'
        }
    }
    stage('Build'){
        steps {
            echo "some build step"
            sh 'mvn compile'
        }
        post{
            success {
                echo "compile successful"
            }
            failure {
                //automatically skips all other stages after this
                echo "compile failed"
            }
        }
    }
    stage ('Test') {
        steps {
            // -Dmaven.test.failure.ignore=true causes maven to ignore any failed tests & continue with further goals
             sh 'mvn -Dmaven.test.failure.ignore=true test'
        }
        post {
            always {
                junit 'target/surefire-reports/**/*.xml'
            }
            success {
                echo "tests successful"
            }
            failure {
                echo "test classes couldn't be compiled"
            }
            unstable {
                echo "some tests failed"
            }
        }
    }
  }
}