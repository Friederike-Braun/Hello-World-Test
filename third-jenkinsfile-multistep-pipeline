pipeline{
  agent any
  tools {
          maven "3.6.3"
          jdk "JDK-17"
  }

  stages{
    stage('Build'){
        steps {
            sh 'mvn compile test-compile'
        }
    }
    stage ('Test') {
        steps {
            // -Dmaven.test.failure.ignore=true causes maven to ignore any failed tests & continue with further goals
            sh 'mvn -Dmaven.test.failure.ignore=true test'
        }
        post {
            always {
                junit 'target/surefire-reports/**/*.xml'
            }
            unstable {
                error('Build unstable, at least one test failed. Aborting pipeline')
            }
        }
    }
    stage('Package'){
        steps {
            sh 'mvn clean -Dmaven.test.skip package'
        }
    }
    stage('Push to Nexus'){
            steps {
                //generated using jenkins snippet generator
                nexusArtifactUploader artifacts: [
                    [
                        artifactId: 'Hello-World-Test',
                        classifier: '',
                        file: 'target/Hello-World-Test-1.0-SNAPSHOT.jar',
                        type: 'jar'
                    ]
                ],
                credentialsId: 'Diego-Nexus',
                groupId: 'org.example',
                nexusUrl: 'nexus.haeger-consulting.de:8081',
                nexusVersion: 'nexus3',
                protocol: 'http',
                repository: 'friederike-maven-hello-world',
                version: '1.0-SNAPSHOT'
            }
        }
  }
  post{
    failure {
        sh 'mvn clean'
    }
  }
}